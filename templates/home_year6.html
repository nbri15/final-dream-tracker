{% extends "layout.html" %}
{% block title %}Year 6 Home — Dream Tracker{% endblock %}
{% block content %}
<h1>{{ klass.name }} — Year 6 Home</h1>

<section class="card">
  <form method="get" class="inline" action="{{ url_for('y6_home') }}">
    {% if is_admin %}
      <label>Class<br>
        <select name="class">
          {% for c in classes if c.year_group == 6 %}
            <option value="{{ c.id }}" {{ 'selected' if (selected_class_id|string == c.id|string) else '' }}>{{ c.name }}</option>
          {% endfor %}
        </select>
      </label>
    {% endif %}
    <label>Year<br>
      <select name="year">
        {% for y in years %}
          <option value="{{ y.id }}" {{ 'selected' if y.id == selected_year_id else '' }}>{{ y.label }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Subject block<br>
      <select name="subject">
        <option value="all" {{ 'selected' if filters.subject == 'all' else '' }}>All</option>
        <option value="maths" {{ 'selected' if filters.subject == 'maths' else '' }}>Maths</option>
        <option value="reading" {{ 'selected' if filters.subject == 'reading' else '' }}>Reading</option>
        <option value="spag" {{ 'selected' if filters.subject == 'spag' else '' }}>SPaG</option>
      </select>
    </label>

    <input type="hidden" name="gender" value="{{ filters.gender }}">
    <input type="hidden" name="pp" value="{{ filters.pp }}">
    <input type="hidden" name="laps" value="{{ filters.laps }}">
    <input type="hidden" name="service" value="{{ filters.service }}">

    <button class="button" type="submit">Apply</button>
    <a class="button" href="{{ url_for('y6_home', class=selected_class_id, year=selected_year_id) }}">Clear</a>
  </form>
</section>

<section class="card">
  <form method="get" class="filter-bar">
    {% if selected_class_id %}<input type="hidden" name="class" value="{{ selected_class_id }}">{% endif %}
    {% if selected_year_id %}<input type="hidden" name="year" value="{{ selected_year_id }}">{% endif %}
    <input type="hidden" name="subject" value="{{ filters.subject }}">

    <label>PP
      <select name="pp">
        <option value="all" {{ 'selected' if filters.pp == 'all' else '' }}>All</option>
        <option value="pp" {{ 'selected' if filters.pp == 'pp' else '' }}>PP</option>
        <option value="nonpp" {{ 'selected' if filters.pp == 'nonpp' else '' }}>Non-PP</option>
      </select>
    </label>

    <label>Gender
      <select name="gender">
        <option value="all" {{ 'selected' if filters.gender == 'all' else '' }}>All</option>
        <option value="male" {{ 'selected' if filters.gender == 'male' else '' }}>Male</option>
        <option value="female" {{ 'selected' if filters.gender == 'female' else '' }}>Female</option>
      </select>
    </label>

    <label>LAPs
      <select name="laps">
        <option value="all" {{ 'selected' if filters.laps == 'all' else '' }}>All</option>
        <option value="laps" {{ 'selected' if filters.laps == 'laps' else '' }}>LAPs</option>
        <option value="nonlaps" {{ 'selected' if filters.laps == 'nonlaps' else '' }}>Non-LAPs</option>
      </select>
    </label>

    <label>Service child
      <select name="service">
        <option value="all" {{ 'selected' if filters.service == 'all' else '' }}>All</option>
        <option value="service" {{ 'selected' if filters.service == 'service' else '' }}>Service child</option>
        <option value="nonservice" {{ 'selected' if filters.service == 'nonservice' else '' }}>Non-service child</option>
      </select>
    </label>

    <button class="button" type="submit">Apply</button>
    <a class="button" href="{{ url_for(request.endpoint, class=selected_class_id, year=selected_year_id, subject=filters.subject) }}">Reset</a>
  </form>
</section>

<section class="kpis year6-overview">
  {% for subject_key, title in [('maths','Maths'), ('reading','Reading'), ('spag','SPaG')] %}
    {% if filters.subject in ['all', subject_key] %}
      {% set card = overview[subject_key] %}
      <article class="card">
        <h3>{{ title }}</h3>
        <p><strong>Under (&lt;100):</strong> {{ card.under }}</p>
        <p><strong>At (100–110):</strong> {{ card.at }}</p>
        <p><strong>Above (111+):</strong> {{ card.above }}</p>
        <p><strong>Missing:</strong> {{ card.missing }}</p>
        <p><strong>Total:</strong> {{ card.total }}</p>
      </article>
    {% endif %}
  {% endfor %}
</section>

<section class="card">
  {% include "partials/_y6_sats_table.html" %}
</section>
{% endblock %}
